# Автоматизована інформаційна система "Класифікатор посад"

* розроблено Гальченко Ярославом, Генаш Максимом, Шевченко Олександром у КБ "ІС" для НТУУ "КПІ" *


#### Структура файлів та папок
.
├── frontend                 	                Front-end частина додатку
│   ├── public	                                Папка яка видається сервером статики
│   │   ├── build	                            Папка із зібраними файлами Front-end
│   │   └── index.html	                        HTML-файл, що містить цей веб-додаток
│   ├── src	                                Вихідний код Front-end частини
│   │   ├── actions           	                Redux action-и
│   │   ├── common-assets       	            Файли спільні для всієї Front-end-частини
│   │   │   ├── fonts	                        Шрифти
│   │   │   ├── fonts	                        Зображення
│   │   │   └── styles	                        Вендорні стилі
│   │   ├── components           	            React-компоненти
│   │   ├── constants                          Константи(назви Redux action-ів, API URIs, тощо)
│   │   ├── reducers	                        Redux reducer-и
│   │   ├── store
│   │   │   └── configureStore.js	            Налаштування redux store
│   │   ├── utils               	            Функції-утиліти(debounce, deepEqual, тощо)
│   │   ├── main.less	                        Глобальні стилі
│   │   ├── main.jsx	                        JS-точка входу в додаток
│   │   └── routes.jsx	                        Код маршрутизації через React-router
│   └── server.js	                            Вихідний код node.js-сервера статики
├── node_modules	                            NPM модулі (для фронт-енду та node.js-сервера)
├── src                      	                Вихідний код Java-сервера API
│   └──  main	                                Головна папка Java-сервера API
│   │   ├── java	                            Файли Java
│   │   │   ├── config	                    Файли конфігурації (App, БД, API, CORS)
│   │   │   ├── domain	                    Файли сутностуй БД
│   │   │   ├── repository	                DAO
│   │   │   ├── rest	                        Контролери
│   │   │   ├── service	                    Файли сервісів (бізнес логіка)
│   │   │   ├── shared	                    Допоміжні файли (DTO, конвертери тощо)
│   │   │   └── KpiDutiesApplication.java	    Головний файл, з якого запускається додаток
│   │   └── resourses	                        Ресурси, файли налаштування
│   │   │   ├── application.yml	            Конфігураційний файл логування та Jersey
│   │   │   └── application-dev.yml	        Конфігураційний файл БД та порта веб-сервера
│   └──  test	                                Тести для Java-сервера API (JUnit)
├── build.gradle	                            Файл з налаштуваннями Gradle
├── package.json	                            Файл з налаштуваннями NPM
├── settings.gradle	                            Файл з налаштуваннями модулів для Gradle
└── webpack.config.js	                        Кофігурація зборки фронтенду для Webpack


#### Опис сервера API
Для розробки back-end сервера було обрано мову програмування Java 8. Дана мова є потужним засобом для створення enterprise додатків, дозволяє розробляти потужні, надійні та легко масштабовані системи, які можуть працювати під управлінням різних операційних систем.
Сервер розгортається на TCP порту 52300 та надає API для доступу до його сервісів.
При проектуванні серверної частини було використано Spring Framework. Це універсальний багатошаровий J2EE фреймворк з відкритим вихідним кодом для Java-платформи, що полегшує створення web-додатку та реалізації бізнес логіки. В основі Spring лежить патерн Inversion of control. Основна ідея цього патерну полягає в усуненні залежності компонентів або класів додатки від конкретних реалізацій допоміжних інтерфейсів і делегування повноважень з управління створенням потрібних реалізацій IoC контейнеру.
Зокрема було використано:
-   Spring Boot - дозволяє легко створювати повноцінні Spring-додатки та має вбудований Tomcat (web-сервер).
-   Spring Data - дозволяє легше створювати Spring-керовані програми які використовують нові способи доступу до даних, наприклад нереляційні бази даних, map-reduce фреймворки, cloud сервіси, а також поліпшену підтримку реляційних баз даних.
Для організації роботи та створення запитів до бази даних використовується Hibernate - бібліотека для мови програмування Java, призначена для вирішення завдань об'єктно-реляційного відображення (ORM).
Обмін інформацією з клієнтом здійснюється по REST у форматі JSON.
Для реалізації REST архітектури використовується Jersey – бібліотека з відкритим вихідним кодом, яка надає свій власний API, що розширює інструментарій JAX-RS додатковими функціями і утилітами для подальшого спрощення реалізації RESTful сервіса.
Логи записуються з використанням бібліотеки log4j у файл / logs/kpi.log


#### Опис сервера статики
Сервер статики розроблено на платформі node.js з використанням фреймворка Express.js. Вихідний код сервера знаходиться у файлі server.js.
Цей сервер запускається на TCP порту 80 та перенаправляє запити що підпадають під регулярні вирази /\/oauth\/(.*)/, /\/api\/(.*)/ на сервер API.
На запит з адресою /api/occupations/downloadSearchResults, сервер статики генерує в оперативній пам’яті Excel-файл з результатами пошуку посад та повертає його у відповідь.
Статичні файли видаються сервером із папки /frontend/public.
У випадку якщо запит не підпадає під жоден з описаних випадків, сервер повертає файл index.html.
Логи записуються з використанням модуля morgan у файл /frontend/node_server_log.log


#### Опис Front-end частини
Front-end частина веб-додатку виконана у вигляді SPA з використанням React.js + Redux. У веб додатку є лише 1 HTML файл – index.html, який видається сервером статики на будь-який запит у якості HTML5 history API fallback. Іndex.html слугує лише контейнером та імпортує у себе файли style.css та bundle.js – зібрані стилі та скріпти додатку. 
Компіляція front-end-у відбувається з використанням Webpack, конфігурація якого розташована у файлі webpack.config.js. Ця конфігурація містить 2 варіанти компіляції файлів: 
-	Production – передбачає мініфікацію скриптів та стилів, кінцеві файли будуть записані у директорію /frontend/public/build.
-	Development – передбачає додання source map для кожного з файлів вихідного коду, при будь-яких змінах у скриптах чи стилях, проект буде одразу ж перезібрано. Скомпільовані файли зберігаються в оперативній пам’яті. Файл style.css – відсутній, замість цього стилі будуть прописані як JS-код у файлі bundle.js для забезпечення «гарячого перезавантаження». Замість сервера статики server.js, запускається Webpack dev server на TCP-порту 2018, який слідкує за змінами у файлах та одразу ж перебудовує відкритий у браузері веб-додаток без перезавантаження сторінки.
Javascript-код написано з використанням сучасного синтаксису «ECMAscript next» (stage-0 - stage-4 proposals на дату 01.09.2016, повний функціонал якого скоріш за все буде реалізований браузерами до 2018 року), який компілюється за допомогою Babel v6.7 у Javascript-код стандарту ECMAScript 5.1. Також частина скриптів (зокрема модулі, що експортують React-компоненти) написана на мові JSX, які теж компілюються за допомогою Babel у звичайний Javascript-код стандарту ECMAScript 5.1. 
Стилі веб-додатку написано з викорисанням препроцесора LESS, які потім компілюються у CSS3.
Компіляція LESS та Babel включена у конфігурацію Webpack.
Маршрутизація додатку відбувається на Front-end-і за допомогою react-router та react-router-redux.
Верстка React-компонентів виконана з використання фреймворку Bootstrap 3 та шаблону AdminLTE. Деякі віджети взято із бібліотек react-widgets та react-bootstrap. Стан деяких форм контролюється з використанням redux-form v5.3.2


#### Запуск проекту
Перш за все необхідно встановити на комп’тер Node.js v4.5, потім встановити усі необхідні NPM модулі (для цього потрібно відкрити консоль ОС та у корені проекту прописати `npm i`).
Для запуску фронт енд частини та сервера статики у файлі package.json прописані відповідні скріпти:
-	build-prod-win, build-prod-linux – для ОС Windows та Linux відповідно, очищають папку /frontend/public/build та запускають компіляцію файлів через webpack у режимі «production»
-	start-prod-win, start-prod-linux – виконання build-prod-win чи build-prod-linux відповідно та запуск сервера статики
-	start-dev-win, start-dev-linux – для ОС Windows та Linux відповідно, запускають компіляцію файлів через webpack у режимі «development» та запускають Webpack dev server
-	inst-dependencies – встановити усі необхідні NPM модулі
Для виконання цих скріптів потрібно відкрити консоль ОС та у корені проекту прописати `npm run [назва скріпта]`.
Для запуску сервера API потрібно завантажити всі залежності проекту, які записані в файлі build.gradle та зібрати проект. Це все можна зробити автоматично за допомогою системи збирання проектів Gradle, виконавши task ‘bootRun’. Для наступних запусків сервера рекомендовано виконувати команду `clean bootRun` щоб повністю очистити попередню збірку та бути впевненим, що всі оновлення зберуться.
